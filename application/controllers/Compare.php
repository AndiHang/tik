<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto bUucy; bUucy: if (defined("\102\101\123\x45\120\x41\x54\110")) { goto soHlD; } goto hH38L; ojf1R: soHlD: goto sUrfj; hH38L: exit("\x4e\x6f\x20\144\x69\x72\x65\x63\164\x20\163\x63\162\151\160\164\40\x61\143\x63\x65\x73\x73\x20\141\x6c\154\x6f\x77\x65\x64"); goto ojf1R; sUrfj: class Compare extends CI_Controller { function __construct() { goto N1gSb; N1gSb: parent::__construct(); goto mC5HI; mC5HI: $this->CHARACTER_SET = "\165\x74\x66\x38\40\x43\x4f\114\x4c\x41\x54\105\40\x75\x74\x66\x38\x5f\x67\x65\x6e\x65\162\141\x6c\137\143\151"; goto yVWHr; W8t_6: $this->DB2 = $this->load->database("\x6c\x69\166\x65", TRUE); goto KC6qA; yVWHr: $this->DB1 = $this->load->database("\155\141\151\x6e\137\x67\x61\162\165\x64\x61", TRUE); goto W8t_6; KC6qA: } function index() { goto Vl380; bFeX6: A4EEd: goto rPHxT; N4C0F: JTBKT: goto NO_tR; w85Fv: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\143\162\145\x61\x74\x65")) : array(); goto vl8nr; TeCBt: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\xa"; vFoPF: } goto rrjPC; C4Bw2: echo "\x3c\150\x32\76\x54\150\145\x20\144\x61\x74\141\x62\141\163\x65\40\x61\x70\x70\x65\x61\162\x73\40\164\157\x20\142\x65\40\165\160\40\164\x6f\40\x64\x61\164\145\74\57\x68\62\76\xa"; goto u9IhT; x0S81: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto A4EEd; } goto C4Bw2; Xd3GC: $development_tables = $this->DB1->list_tables(); goto fzGcO; g52Uo: echo "\x3c\160\x72\145\40\x73\164\171\x6c\x65\x3d\47\160\x61\144\x64\x69\x6e\147\72\40\62\x30\x70\x78\73\x20\x62\141\x63\153\x67\162\x6f\x75\156\x64\55\143\x6f\154\x6f\x72\72\40\x23\106\106\x46\x41\x46\60\x3b\x27\x3e\12"; goto TeCBt; fzGcO: $live_tables = $this->DB2->list_tables(); goto Evw6N; mc1T4: $tables_to_drop = array_diff($live_tables, $development_tables); goto w85Fv; rrjPC: MxK0J: goto qUXa5; kg_5n: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto MNV8X; Vl380: $sql_commands_to_run = array(); goto Xd3GC; PuDN8: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto kg_5n; Evw6N: $tables_to_create = array_diff($development_tables, $live_tables); goto mc1T4; jJs8E: echo "\74\160\x3e\124\150\x65\x20\146\157\154\x6c\x6f\167\151\x6e\147\40\123\121\114\40\x63\x6f\155\155\x61\156\144\x73\x20\x6e\145\145\x64\40\x74\x6f\40\142\x65\x20\145\x78\145\x63\165\x74\x65\144\40\164\x6f\40\142\162\151\156\147\40\164\150\145\40\114\x69\166\x65\40\x64\141\x74\x61\142\x61\163\x65\x20\164\x61\x62\154\145\x73\x20\165\x70\40\164\x6f\40\144\x61\164\x65\x3a\40\74\x2f\160\76\12"; goto g52Uo; rPHxT: echo "\74\x68\62\76\x54\x68\145\x20\x64\141\164\x61\x62\141\x73\145\40\151\163\40\x6f\x75\x74\x20\x6f\x66\x20\123\x79\156\143\x21\x3c\57\x68\62\76\12"; goto jJs8E; MNV8X: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto x0S81; vl8nr: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\x64\162\157\x70")) : array(); goto PuDN8; u9IhT: goto JTBKT; goto bFeX6; qUXa5: echo "\74\x70\x72\x65\76\xa"; goto N4C0F; NO_tR: } function manage_tables($tables, $action) { goto WiVEz; i0nxZ: foreach ($tables as $table) { goto gZjQ2; gZjQ2: $query = $this->DB1->query("\123\x48\117\x57\40\103\122\105\x41\x54\x45\40\x54\101\102\114\x45\40\140{$table}\x60\40\x2d\x2d\40\143\162\145\x61\164\x65\x20\x74\x61\142\154\145\x73"); goto ciYYE; SPpgA: $sql_commands_to_run[] = $table_structure["\103\162\x65\x61\x74\x65\x20\124\141\x62\154\145"] . "\x3b"; goto iVFyB; iVFyB: FDoDk: goto a68jX; ciYYE: $table_structure = $query->row_array(); goto SPpgA; a68jX: } goto c01qc; c01qc: UUuky: goto XsqZf; r85NR: DT9DT: goto JjwCr; XsqZf: LYo4x: goto wmbNm; wmbNm: if (!($action == "\144\x72\157\x70")) { goto DT9DT; } goto HTcnY; QMQZL: if (!($action == "\143\162\145\141\x74\145")) { goto LYo4x; } goto i0nxZ; c5hyb: uZFoI: goto r85NR; HTcnY: foreach ($tables as $table) { $sql_commands_to_run[] = "\x44\x52\117\120\x20\124\101\x42\x4c\x45\x20{$table}\x3b"; h_0HQ: } goto c5hyb; WiVEz: $sql_commands_to_run = array(); goto QMQZL; JjwCr: return $sql_commands_to_run; goto jOsam; jOsam: } function compare_table_structures($development_tables, $live_tables) { goto c6EqN; cksN4: foreach ($live_tables as $table) { goto NCUEf; khLDk: Wfn9d: goto Dfurr; NCUEf: $query = $this->DB2->query("\x53\x48\117\127\x20\x43\122\x45\x41\x54\x45\40\124\x41\x42\114\105\x20\x60{$table}\140\x20\55\55\x20\x6c\151\166\145"); goto AV3Gs; AV3Gs: $table_structure = $query->row_array(); goto likEO; likEO: $live_table_structures[$table] = $table_structure["\103\x72\145\x61\164\145\40\124\x61\142\x6c\145"]; goto khLDk; Dfurr: } goto Grhr7; R_Dke: $live_table_structures = $development_table_structures = array(); goto i_WIF; s6sDU: return $tables_need_updating; goto CZuxp; UqQDw: VSX1C: goto s6sDU; Grhr7: pBdgj: goto i1MBS; i1MBS: foreach ($development_tables as $table) { goto oxC2j; oxC2j: $development_table = $development_table_structures[$table]; goto jxnTt; FyH25: Vdr6d: goto agRBJ; agRBJ: dQCVx: goto G2RDx; CPV0b: $tables_need_updating[] = $table; goto FyH25; m5F7Q: if (!($this->count_differences($development_table, $live_table) > 0)) { goto Vdr6d; } goto CPV0b; jxnTt: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto m5F7Q; G2RDx: } goto UqQDw; i_WIF: foreach ($development_tables as $table) { goto tqiPH; o9CmG: dqUEz: goto U4TjN; WgQOY: $development_table_structures[$table] = $table_structure["\x43\x72\145\141\164\145\x20\124\x61\142\x6c\x65"]; goto o9CmG; tqiPH: $query = $this->DB1->query("\x53\x48\x4f\127\40\x43\x52\105\x41\x54\x45\x20\x54\101\x42\114\105\x20\140{$table}\140\40\55\x2d\x20\x64\x65\x76"); goto rnzAb; rnzAb: $table_structure = $query->row_array(); goto WgQOY; U4TjN: } goto bh3S4; c6EqN: $tables_need_updating = array(); goto R_Dke; bh3S4: CY5xa: goto cksN4; CZuxp: } function count_differences($old, $new) { goto KFogu; FsPDB: Td9aN: goto mOzrG; YWZD4: return $differences; goto ezMLc; KFogu: $differences = 0; goto stcCS; ezMLc: fmNte: goto H6Az8; k5kze: $i = 0; goto ySVbh; mOzrG: return $differences; goto BLjns; H6Az8: $old = explode("\x20", $old); goto FmPUC; stcCS: $old = trim(preg_replace("\x2f\134\x73\53\57", '', $old)); goto iWNLP; rsCNt: if (!($old[$i] != $new[$i])) { goto IWfqi; } goto cKDqf; D9xqH: goto zaos5; goto FsPDB; Mydsg: IWfqi: goto GAKaj; GR3UU: $i++; goto D9xqH; FmPUC: $new = explode("\40", $new); goto OZo2K; Uw60J: if (!($old == $new)) { goto fmNte; } goto YWZD4; ySVbh: zaos5: goto ylvTa; OZo2K: $length = max(count($old), count($new)); goto k5kze; GAKaj: JQQx6: goto GR3UU; iWNLP: $new = trim(preg_replace("\57\x5c\163\x2b\57", '', $new)); goto Uw60J; ylvTa: if (!($i < $length)) { goto Td9aN; } goto rsCNt; cKDqf: $differences++; goto Mydsg; BLjns: } function update_existing_tables($tables) { goto B6cZ8; nlhKZ: $table_structure_development = array(); goto SI4gK; rC06v: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto Mx7U0; SI4gK: $table_structure_live = array(); goto FZEm4; VJFwd: evmAU: goto hT1yG; FZEm4: if (!(is_array($tables) && !empty($tables))) { goto MyU_u; } goto uDgSU; hT1yG: MyU_u: goto rC06v; uDgSU: foreach ($tables as $table) { goto Ec6eJ; Ec6eJ: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto fiR8O; rlarL: wtwbp: goto ajcX5; fiR8O: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto rlarL; ajcX5: } goto VJFwd; B6cZ8: $sql_commands_to_run = array(); goto nlhKZ; Mx7U0: return $sql_commands_to_run; goto SeYbL; SeYbL: } function table_field_data($database, $table) { goto RBmq2; NnAKG: if (!($row = mysql_fetch_assoc($result))) { goto OmI00; } goto OQkY7; RBmq2: $conn = mysqli_connect($database["\x68\157\x73\x74\x6e\x61\155\145"], $database["\x75\x73\x65\x72\x6e\x61\x6d\145"], $database["\160\141\163\163\x77\x6f\x72\x64"]); goto VDLQT; qHHsQ: goto qGzCy; goto spYu0; VdmoF: qGzCy: goto NnAKG; spYu0: OmI00: goto tUk6r; OQkY7: $fields[] = $row; goto qHHsQ; tUk6r: return $fields; goto btgsv; jY7cQ: $result = mysql_query("\x53\110\117\x57\40\103\x4f\114\125\x4d\x4e\x53\x20\x46\x52\117\115\40\x60{$table}\x60"); goto VdmoF; VDLQT: mysql_select_db($database["\x64\141\x74\x61\x62\x61\163\145"]); goto jY7cQ; btgsv: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto IY2ho; IY2ho: $sql_commands_to_run = array(); goto oCoEF; oCoEF: foreach ($source_field_structures as $table => $fields) { goto r3h6E; mgcWl: dJ7M8: goto cj1R5; cIweF: cJHm6: goto mgcWl; r3h6E: foreach ($fields as $field) { goto gIlzp; rFXnd: $add_field .= "\40\104\105\106\x41\125\114\124\x20" . $field["\104\145\x66\x61\165\x6c\164"]; goto O1ZVd; bfZRR: $add_field .= "\x3b"; goto pcZ61; DbFga: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto F9AlH; awSNg: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto RfPHj; } goto SQRXT; pVZb4: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\106\x69\145\x6c\144"] == $destination_field_structures[$table][$n]["\x46\x69\145\x6c\x64"])) { goto q5XNn; } goto DbFga; Xw4lF: OFSdb: goto erdVz; tK0WA: $add_field = "\101\114\124\x45\x52\40\124\x41\x42\114\x45\40{$table}\x20\101\104\x44\x20\x43\x4f\x4c\125\115\x4e\40\x60" . $field["\106\151\x65\154\x64"] . "\140\x20" . $field["\124\171\160\145"] . "\x20\103\110\x41\122\101\103\124\x45\122\x20\x53\105\x54\40" . $this->CHARACTER_SET; goto aEr0G; WGuKj: CJpWS: goto iEEOQ; aFuzh: $modify_field .= isset($fields[$n]["\105\x78\164\x72\141"]) && $fields[$n]["\105\x78\164\162\141"] != '' ? "\x20" . $fields[$n]["\x45\x78\x74\162\141"] : ''; goto CjB1z; erdVz: if (!($n < count($fields))) { goto eIEcx; } goto pVZb4; pHP8v: q5XNn: goto awSNg; CjB1z: $modify_field .= isset($previous_field) && $previous_field != '' ? "\40\x41\x46\x54\x45\122\x20" . $previous_field : ''; goto QYHr7; wIc5z: $n++; goto dfdlk; Ccqrb: $modify_field .= isset($fields[$n]["\x4e\x75\154\154"]) && $fields[$n]["\x4e\165\154\154"] == "\x59\x45\123" ? "\40\116\x55\114\x4c" : "\x20\x4e\x4f\x54\40\x4e\125\x4c\114"; goto aFuzh; gIlzp: if ($this->in_array_recursive($field["\106\x69\145\x6c\x64"], $destination_field_structures[$table])) { goto N9psc; } goto tK0WA; EOcws: $n = 0; goto Xw4lF; cce5c: N9psc: goto kPK82; kPK82: $modify_field = ''; goto EOcws; Kw_IR: w3Mhi: goto wIc5z; LXSiF: $modify_field = "\x41\114\124\x45\122\x20\124\101\102\114\105\40{$table}\x20\x4d\x4f\x44\x49\106\131\x20\103\x4f\114\x55\115\116\x20\140" . $fields[$n]["\x46\151\145\x6c\x64"] . "\140\40" . $fields[$n]["\x54\x79\x70\145"] . "\x20\103\110\x41\x52\x41\103\x54\x45\x52\40\x53\x45\x54\x20" . $this->CHARACTER_SET; goto lad8Q; uzbki: RfPHj: goto Kw_IR; O1ZVd: $add_field .= isset($field["\x45\170\164\x72\x61"]) && $field["\105\x78\x74\x72\141"] != '' ? "\x20" . $field["\105\x78\x74\162\141"] : ''; goto bfZRR; jVWBE: goto CJpWS; goto cce5c; G3WIG: eIEcx: goto WGuKj; SQRXT: $sql_commands_to_run[] = $modify_field; goto uzbki; aEr0G: $add_field .= isset($field["\116\x75\154\154"]) && $field["\116\x75\x6c\154"] == "\x59\x45\123" ? "\40\x4e\x75\154\x6c" : ''; goto rFXnd; yVR4a: $previous_field = $fields[$n]["\x46\x69\145\154\x64"]; goto pHP8v; iEEOQ: EhFre: goto gWkLx; QYHr7: $modify_field .= "\73"; goto H75EA; F9AlH: if (!(is_array($differences) && !empty($differences))) { goto kI8Y4; } goto LXSiF; dfdlk: goto OFSdb; goto G3WIG; H75EA: kI8Y4: goto yVR4a; lad8Q: $modify_field .= isset($fields[$n]["\x44\x65\146\x61\x75\154\x74"]) && $fields[$n]["\x44\145\146\x61\165\x6c\x74"] != '' ? "\x20\x44\x45\106\101\x55\x4c\x54\40\x27" . $fields[$n]["\104\145\146\141\x75\154\164"] . "\47" : ''; goto Ccqrb; pcZ61: $sql_commands_to_run[] = $add_field; goto jVWBE; gWkLx: } goto cIweF; cj1R5: } goto LTQCG; LTQCG: ZDYet: goto U3JiL; U3JiL: return $sql_commands_to_run; goto mktwi; mktwi: } function in_array_recursive($needle, $haystack, $strict = false) { goto iAxni; M09v5: return false; goto NB9MB; KUq_w: H4R0Y: goto M09v5; iAxni: foreach ($haystack as $array => $item) { goto ZymSs; ZymSs: $item = $item["\106\151\145\154\x64"]; goto Tf1kX; Tf1kX: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto i2aDc; } goto KeDLI; KeDLI: return true; goto dwJfG; dwJfG: i2aDc: goto ujYd0; ujYd0: yjnFt: goto V1uM0; V1uM0: } goto KUq_w; NB9MB: } }
