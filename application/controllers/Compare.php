<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto NW6aO; k3Bbu: exit("\x4e\157\40\144\151\162\145\143\164\x20\163\x63\162\x69\x70\164\40\141\143\x63\145\x73\163\x20\x61\x6c\154\157\x77\x65\144"); goto yVz11; yVz11: kbJZV: goto vL7_0; NW6aO: if (defined("\x42\101\123\x45\120\x41\124\x48")) { goto kbJZV; } goto k3Bbu; vL7_0: class Compare extends CI_Controller { function __construct() { goto CH6FZ; CH6FZ: parent::__construct(); goto DjFaW; DjFaW: $this->CHARACTER_SET = "\x75\x74\x66\70\40\x43\117\114\x4c\x41\x54\x45\x20\x75\164\146\70\x5f\147\x65\156\145\x72\x61\154\x5f\x63\x69"; goto NTGYi; T_r5R: $this->DB2 = $this->load->database("\x6c\151\x76\x65", TRUE); goto cIfpy; NTGYi: $this->DB1 = $this->load->database("\x6d\141\x69\156\137\147\x61\x72\165\144\141", TRUE); goto T_r5R; cIfpy: } function index() { goto JFCWE; E22TA: $live_tables = $this->DB2->list_tables(); goto fOBaK; ASCzC: PGx1K: goto W4Eqs; uj2Gb: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto e2OWU; y311P: BpMQ4: goto qJGz3; UkCqQ: goto BpMQ4; goto ASCzC; lwQqu: echo "\74\x70\162\x65\x20\x73\x74\x79\x6c\x65\75\x27\160\x61\144\x64\151\x6e\x67\72\x20\x32\60\160\170\x3b\40\x62\141\x63\x6b\x67\x72\x6f\165\x6e\144\55\143\x6f\x6c\x6f\x72\72\40\43\106\106\106\101\x46\60\x3b\x27\x3e\12"; goto XHM04; JFCWE: $sql_commands_to_run = array(); goto TCGUP; W4Eqs: echo "\x3c\x68\x32\x3e\x54\150\x65\x20\x64\141\x74\141\142\141\163\145\x20\151\x73\x20\157\165\x74\40\157\x66\40\123\x79\156\143\x21\x3c\57\150\x32\x3e\12"; goto HxBrR; HxBrR: echo "\74\x70\76\x54\x68\145\40\146\157\154\154\x6f\x77\151\x6e\x67\40\x53\121\x4c\40\x63\x6f\155\155\141\x6e\144\x73\x20\x6e\145\x65\x64\40\164\157\x20\x62\145\40\x65\x78\145\x63\165\x74\145\144\40\x74\157\40\142\162\x69\x6e\x67\40\x74\x68\x65\40\x4c\x69\x76\x65\x20\144\141\164\x61\x62\141\163\x65\x20\x74\141\x62\x6c\145\x73\x20\x75\160\40\x74\157\x20\144\x61\x74\x65\x3a\x20\74\57\160\x3e\12"; goto lwQqu; iGUC8: echo "\74\x68\x32\x3e\124\150\x65\x20\x64\141\x74\141\142\141\163\x65\x20\x61\160\x70\145\141\162\163\x20\x74\157\40\x62\x65\x20\x75\x70\40\x74\x6f\40\x64\141\164\145\x3c\57\150\x32\76\12"; goto UkCqQ; RyYkj: $tables_to_drop = array_diff($live_tables, $development_tables); goto MpoBZ; rVlXH: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto PGx1K; } goto iGUC8; SEYJH: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto rVlXH; nv5Si: h8dTj: goto paF6u; fOBaK: $tables_to_create = array_diff($development_tables, $live_tables); goto RyYkj; MpoBZ: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\x63\x72\x65\141\x74\145")) : array(); goto nX2hs; e2OWU: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto SEYJH; TCGUP: $development_tables = $this->DB1->list_tables(); goto E22TA; nX2hs: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\144\x72\157\x70")) : array(); goto uj2Gb; paF6u: echo "\74\x70\x72\145\x3e\xa"; goto y311P; XHM04: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\12"; rSbvH: } goto nv5Si; qJGz3: } function manage_tables($tables, $action) { goto PAkBc; PAkBc: $sql_commands_to_run = array(); goto YyKag; gtMs3: if (!($action == "\144\162\x6f\x70")) { goto sydXc; } goto rzBmq; nL1Rv: pWCH3: goto gtMs3; YyKag: if (!($action == "\x63\x72\x65\141\164\x65")) { goto pWCH3; } goto TwAhG; nBhrT: return $sql_commands_to_run; goto YA3j9; qenSs: sydXc: goto nBhrT; TwAhG: foreach ($tables as $table) { goto e2Khd; OVvSN: $sql_commands_to_run[] = $table_structure["\x43\162\x65\141\x74\x65\x20\124\x61\x62\154\145"] . "\73"; goto vd8OG; e2Khd: $query = $this->DB1->query("\123\110\x4f\127\x20\103\x52\x45\101\x54\105\x20\124\x41\102\114\x45\x20\140{$table}\x60\40\55\x2d\40\x63\x72\x65\141\164\145\40\164\x61\142\x6c\145\x73"); goto SsBjp; vd8OG: RaZlk: goto cyhKV; SsBjp: $table_structure = $query->row_array(); goto OVvSN; cyhKV: } goto FIp2P; FIp2P: vXl6N: goto nL1Rv; skqZx: kO_vb: goto qenSs; rzBmq: foreach ($tables as $table) { $sql_commands_to_run[] = "\104\x52\117\x50\x20\x54\101\x42\114\105\x20{$table}\73"; J9HUE: } goto skqZx; YA3j9: } function compare_table_structures($development_tables, $live_tables) { goto zEPAG; R10O2: foreach ($development_tables as $table) { goto ni4HK; ni4HK: $query = $this->DB1->query("\x53\110\117\x57\40\103\122\x45\101\124\x45\40\x54\101\102\x4c\105\x20\140{$table}\140\x20\55\x2d\x20\144\x65\x76"); goto JsOZS; JsOZS: $table_structure = $query->row_array(); goto zUxgO; JbWWI: OSWy8: goto MI2lj; zUxgO: $development_table_structures[$table] = $table_structure["\x43\x72\x65\141\x74\x65\40\124\x61\142\154\x65"]; goto JbWWI; MI2lj: } goto MblRj; LfgZZ: vcRl9: goto qVSy8; mqgir: $live_table_structures = $development_table_structures = array(); goto R10O2; qVSy8: foreach ($development_tables as $table) { goto j1bQo; j1bQo: $development_table = $development_table_structures[$table]; goto hxo7x; hxo7x: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto fY6U0; yW7eh: $tables_need_updating[] = $table; goto SNQJz; E73Gw: NYCh2: goto y_zn8; SNQJz: eGxSY: goto E73Gw; fY6U0: if (!($this->count_differences($development_table, $live_table) > 0)) { goto eGxSY; } goto yW7eh; y_zn8: } goto gOqbu; zEPAG: $tables_need_updating = array(); goto mqgir; MblRj: PtH83: goto MZmQy; MZmQy: foreach ($live_tables as $table) { goto Rumxr; Rumxr: $query = $this->DB2->query("\x53\110\117\127\x20\x43\122\x45\101\x54\105\x20\124\x41\102\x4c\x45\x20\140{$table}\140\40\55\x2d\x20\x6c\151\x76\145"); goto BZJZC; Ev5PV: uU1xa: goto nK7Te; BZJZC: $table_structure = $query->row_array(); goto jOM8C; jOM8C: $live_table_structures[$table] = $table_structure["\103\x72\x65\141\164\145\40\x54\x61\x62\x6c\145"]; goto Ev5PV; nK7Te: } goto LfgZZ; gOqbu: BJ1rx: goto ybPTC; ybPTC: return $tables_need_updating; goto UWNpB; UWNpB: } function count_differences($old, $new) { goto MIUmq; a0Xr7: if (!($old[$i] != $new[$i])) { goto gIl0c; } goto VWlaR; ianb_: $old = trim(preg_replace("\x2f\x5c\163\53\57", '', $old)); goto CFA15; VWlaR: $differences++; goto usBJb; eo4Ki: dln8y: goto siDg7; MIUmq: $differences = 0; goto ianb_; VgopE: return $differences; goto UV3mk; d3N2X: fBk2I: goto VgopE; KvFzl: $length = max(count($old), count($new)); goto WzQqy; uajFj: if (!($i < $length)) { goto fBk2I; } goto a0Xr7; hP0gV: return $differences; goto eo4Ki; usBJb: gIl0c: goto TqnNo; TqnNo: fVSlf: goto gtX5X; uZHD9: goto N4SqR; goto d3N2X; WzQqy: $i = 0; goto COJkH; gtX5X: $i++; goto uZHD9; FD4Ul: if (!($old == $new)) { goto dln8y; } goto hP0gV; CFA15: $new = trim(preg_replace("\57\x5c\x73\x2b\x2f", '', $new)); goto FD4Ul; COJkH: N4SqR: goto uajFj; vwFPC: $new = explode("\40", $new); goto KvFzl; siDg7: $old = explode("\40", $old); goto vwFPC; UV3mk: } function update_existing_tables($tables) { goto Gh0sQ; Gh0sQ: $sql_commands_to_run = array(); goto vojXn; CIibY: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto NAOSU; wyTSI: foreach ($tables as $table) { goto HCGwS; HCGwS: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto LjwGE; LjwGE: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto cZvlQ; cZvlQ: AttSu: goto RYEN8; RYEN8: } goto LT_12; vojXn: $table_structure_development = array(); goto xBTPL; LT_12: oEXvV: goto zoM_k; NAOSU: return $sql_commands_to_run; goto etrHw; zoM_k: itAIB: goto CIibY; xBTPL: $table_structure_live = array(); goto O4FW0; O4FW0: if (!(is_array($tables) && !empty($tables))) { goto itAIB; } goto wyTSI; etrHw: } function table_field_data($database, $table) { goto ZKlXU; ZKlXU: $conn = mysqli_connect($database["\150\157\x73\164\156\x61\155\145"], $database["\165\x73\145\x72\156\x61\x6d\x65"], $database["\160\141\x73\x73\167\x6f\x72\144"]); goto w2GX8; sJ2M2: if (!($row = mysql_fetch_assoc($result))) { goto dwA7G; } goto tUvot; tUvot: $fields[] = $row; goto KSoBs; KSoBs: goto R_gsO; goto K5vCw; uCPqe: R_gsO: goto sJ2M2; K5vCw: dwA7G: goto CiYd9; ajjRi: $result = mysql_query("\123\x48\x4f\x57\x20\103\x4f\114\x55\x4d\116\123\x20\x46\x52\x4f\115\x20\x60{$table}\140"); goto uCPqe; w2GX8: mysql_select_db($database["\144\141\164\x61\x62\x61\x73\x65"]); goto ajjRi; CiYd9: return $fields; goto xHkfm; xHkfm: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto EjTqL; NNoGq: sUAfv: goto VVQzV; EjTqL: $sql_commands_to_run = array(); goto EgpYe; EgpYe: foreach ($source_field_structures as $table => $fields) { goto mZQjh; u3rta: fkc1t: goto sWJl8; mZQjh: foreach ($fields as $field) { goto LMoRR; jsMDV: $n++; goto wwFyr; WY_y2: $add_field = "\101\x4c\124\x45\x52\x20\x54\101\102\x4c\105\x20{$table}\x20\101\104\x44\x20\103\117\114\x55\x4d\x4e\40\x60" . $field["\x46\151\145\x6c\x64"] . "\140\40" . $field["\x54\x79\160\x65"] . "\40\x43\110\x41\122\101\x43\124\x45\x52\x20\x53\x45\x54\x20" . $this->CHARACTER_SET; goto W2g2i; ttCob: $modify_field .= isset($fields[$n]["\105\170\x74\162\x61"]) && $fields[$n]["\x45\170\164\x72\141"] != '' ? "\x20" . $fields[$n]["\105\170\164\162\141"] : ''; goto Alm2L; YQXHw: $modify_field = "\x41\x4c\124\105\122\40\124\x41\x42\x4c\105\40{$table}\40\x4d\x4f\x44\x49\106\131\40\103\x4f\114\125\x4d\116\40\x60" . $fields[$n]["\x46\151\x65\154\144"] . "\140\40" . $fields[$n]["\x54\x79\x70\x65"] . "\40\x43\110\x41\122\x41\103\124\105\122\x20\123\x45\124\x20" . $this->CHARACTER_SET; goto XgrxK; hUrw1: $add_field .= "\40\104\x45\106\x41\125\x4c\x54\40" . $field["\104\145\x66\141\165\x6c\164"]; goto dp2jX; HJyUx: QotSz: goto jsMDV; NV4mD: $modify_field .= "\x3b"; goto GP2Wb; W2g2i: $add_field .= isset($field["\x4e\x75\154\x6c"]) && $field["\x4e\165\x6c\154"] == "\131\x45\x53" ? "\x20\116\165\x6c\154" : ''; goto hUrw1; Alm2L: $modify_field .= isset($previous_field) && $previous_field != '' ? "\x20\x41\106\124\105\122\x20" . $previous_field : ''; goto NV4mD; GP2Wb: jW91x: goto ahHp9; IgROR: Xr20S: goto jbS1N; n9u68: U7EAE: goto oxw2C; jbS1N: if (!($n < count($fields))) { goto zN8qv; } goto tL48R; jrXjZ: BtIOy: goto XxsfR; PnnKi: $sql_commands_to_run[] = $add_field; goto V1PtL; E2TkU: if (!(is_array($differences) && !empty($differences))) { goto jW91x; } goto YQXHw; hd5yV: $add_field .= "\x3b"; goto PnnKi; XxsfR: $modify_field = ''; goto ycbrR; mQ1JJ: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto BySlY; } goto dt6tY; tL48R: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\x46\151\145\x6c\144"] == $destination_field_structures[$table][$n]["\106\x69\x65\154\x64"])) { goto JGAvV; } goto y7sKp; dp2jX: $add_field .= isset($field["\105\170\164\162\141"]) && $field["\x45\x78\164\162\141"] != '' ? "\x20" . $field["\105\170\x74\x72\x61"] : ''; goto hd5yV; LMoRR: if ($this->in_array_recursive($field["\x46\x69\145\x6c\144"], $destination_field_structures[$table])) { goto BtIOy; } goto WY_y2; wwFyr: goto Xr20S; goto mFgl2; V1PtL: goto kAfWQ; goto jrXjZ; mFgl2: zN8qv: goto a1dgL; y7sKp: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto E2TkU; a1dgL: kAfWQ: goto n9u68; ahHp9: $previous_field = $fields[$n]["\106\x69\x65\x6c\144"]; goto j2BaQ; XgrxK: $modify_field .= isset($fields[$n]["\x44\x65\x66\141\x75\154\164"]) && $fields[$n]["\x44\145\x66\141\165\x6c\x74"] != '' ? "\x20\104\x45\106\x41\125\114\124\x20\47" . $fields[$n]["\x44\x65\146\141\x75\x6c\x74"] . "\47" : ''; goto R_LVA; R_LVA: $modify_field .= isset($fields[$n]["\x4e\x75\154\x6c"]) && $fields[$n]["\x4e\165\x6c\154"] == "\131\x45\x53" ? "\40\116\x55\x4c\x4c" : "\x20\x4e\x4f\124\40\116\125\x4c\114"; goto ttCob; CwWaX: BySlY: goto HJyUx; ycbrR: $n = 0; goto IgROR; j2BaQ: JGAvV: goto mQ1JJ; dt6tY: $sql_commands_to_run[] = $modify_field; goto CwWaX; oxw2C: } goto u3rta; sWJl8: YX2SX: goto wEpkn; wEpkn: } goto NNoGq; VVQzV: return $sql_commands_to_run; goto xhD4L; xhD4L: } function in_array_recursive($needle, $haystack, $strict = false) { goto X_8Nw; X_8Nw: foreach ($haystack as $array => $item) { goto ldnrY; HzCP0: GQ6Uo: goto DzV4Y; yPDGT: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto oqfaX; } goto NVKwQ; NVKwQ: return true; goto JKuJH; JKuJH: oqfaX: goto HzCP0; ldnrY: $item = $item["\x46\x69\x65\x6c\x64"]; goto yPDGT; DzV4Y: } goto JmW63; JmW63: DcXw7: goto kyFCo; kyFCo: return false; goto cRdNN; cRdNN: } }
