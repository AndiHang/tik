<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto H32QM; H32QM: if (defined("\102\101\x53\105\x50\x41\x54\x48")) { goto Shsfx; } goto ES4rr; ES4rr: exit("\116\x6f\x20\x64\151\162\145\x63\x74\40\x73\143\x72\151\x70\164\x20\141\143\143\145\x73\163\x20\x61\154\154\157\167\145\x64"); goto WnK9z; WnK9z: Shsfx: goto VpBzK; VpBzK: class Compare extends CI_Controller { function __construct() { goto ZeHg5; ZeHg5: parent::__construct(); goto QHVNl; kXXNk: $this->DB1 = $this->load->database("\155\141\151\156\137\x67\141\x72\x75\144\141", TRUE); goto bSmM_; bSmM_: $this->DB2 = $this->load->database("\154\x69\x76\x65", TRUE); goto XOzau; QHVNl: $this->CHARACTER_SET = "\165\x74\x66\x38\40\103\117\114\x4c\x41\x54\105\x20\x75\164\x66\70\137\x67\145\x6e\145\x72\x61\154\137\143\x69"; goto kXXNk; XOzau: } function index() { goto mrroc; J2RV7: $tables_to_create = array_diff($development_tables, $live_tables); goto iTtkS; bhyDz: echo "\74\x68\x32\76\x54\x68\x65\40\x64\x61\164\x61\142\141\x73\x65\x20\x61\160\x70\145\x61\x72\x73\40\x74\157\x20\142\x65\40\165\160\x20\164\157\x20\x64\x61\164\x65\74\57\x68\x32\76\xa"; goto ls0Oi; zuosy: $development_tables = $this->DB1->list_tables(); goto hVHTC; kJzSI: r5z4_: goto x6yd9; hVHTC: $live_tables = $this->DB2->list_tables(); goto J2RV7; iTtkS: $tables_to_drop = array_diff($live_tables, $development_tables); goto ThLy6; L0uH0: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto Pe_sb; } goto bhyDz; ThLy6: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\x63\x72\145\141\x74\x65")) : array(); goto Sx07o; mrroc: $sql_commands_to_run = array(); goto zuosy; lgva7: echo "\x3c\150\62\76\124\150\145\40\x64\x61\164\141\x62\x61\x73\145\x20\151\163\x20\x6f\165\x74\40\x6f\146\x20\123\171\156\143\41\74\57\150\x32\x3e\xa"; goto X7aQD; BwxLk: echo "\x3c\160\162\145\40\163\x74\x79\x6c\x65\x3d\47\160\141\144\144\x69\x6e\147\72\x20\62\60\x70\170\73\x20\142\x61\x63\x6b\147\x72\157\x75\156\x64\x2d\143\157\154\x6f\162\x3a\40\x23\x46\x46\x46\101\106\x30\x3b\47\x3e\xa"; goto cbZ0w; Hx31l: echo "\x3c\160\162\x65\76\xa"; goto kJzSI; cbZ0w: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\12"; PvFjf: } goto P3GX0; Sx07o: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\x64\162\157\160")) : array(); goto sAjiy; ls0Oi: goto r5z4_; goto OxmwO; OxmwO: Pe_sb: goto lgva7; M2N2O: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto L0uH0; RIk99: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto M2N2O; P3GX0: AYGBR: goto Hx31l; X7aQD: echo "\x3c\160\76\124\x68\145\x20\x66\x6f\x6c\x6c\x6f\167\x69\x6e\x67\40\123\121\114\40\143\157\155\x6d\x61\156\x64\163\40\156\145\x65\144\x20\164\x6f\40\142\145\40\x65\x78\145\143\x75\164\x65\x64\40\164\157\40\142\162\x69\x6e\x67\40\x74\150\x65\x20\x4c\x69\166\145\x20\144\141\x74\141\x62\141\x73\x65\40\164\141\x62\154\x65\x73\40\x75\160\x20\164\x6f\40\x64\141\x74\145\72\40\x3c\x2f\160\76\12"; goto BwxLk; sAjiy: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto RIk99; x6yd9: } function manage_tables($tables, $action) { goto Ugn1N; qc_I4: foreach ($tables as $table) { goto J7ROa; KPjsr: VcQX4: goto RQg2I; J7ROa: $query = $this->DB1->query("\x53\x48\x4f\127\40\103\122\105\x41\x54\x45\40\124\101\102\x4c\105\40\140{$table}\x60\x20\55\x2d\x20\x63\162\x65\x61\164\145\x20\164\141\142\154\145\163"); goto yjVmV; AykJQ: $sql_commands_to_run[] = $table_structure["\103\x72\x65\x61\164\145\40\124\141\142\154\145"] . "\x3b"; goto KPjsr; yjVmV: $table_structure = $query->row_array(); goto AykJQ; RQg2I: } goto mdPBe; Ugn1N: $sql_commands_to_run = array(); goto mYafd; Txm4a: return $sql_commands_to_run; goto wDnAZ; VFPvt: U26lS: goto Txm4a; fMLYw: if (!($action == "\144\x72\x6f\x70")) { goto U26lS; } goto Xj1_U; mYafd: if (!($action == "\x63\x72\x65\x61\164\145")) { goto Q2Kii; } goto qc_I4; uu1fC: EroQw: goto VFPvt; Xj1_U: foreach ($tables as $table) { $sql_commands_to_run[] = "\x44\x52\x4f\x50\40\124\x41\102\114\x45\40{$table}\73"; joX5u: } goto uu1fC; mdPBe: WcU7L: goto Ln4ad; Ln4ad: Q2Kii: goto fMLYw; wDnAZ: } function compare_table_structures($development_tables, $live_tables) { goto auV2c; auV2c: $tables_need_updating = array(); goto kEIIk; G930F: foreach ($live_tables as $table) { goto CtfAC; JJnrl: UhF7Z: goto W4bcs; qpTgM: $live_table_structures[$table] = $table_structure["\103\x72\145\x61\x74\x65\x20\124\x61\x62\x6c\x65"]; goto JJnrl; CtfAC: $query = $this->DB2->query("\123\x48\x4f\x57\x20\103\x52\105\x41\x54\105\x20\124\x41\x42\x4c\x45\x20\140{$table}\x60\x20\55\55\40\x6c\151\166\x65"); goto IVdhe; IVdhe: $table_structure = $query->row_array(); goto qpTgM; W4bcs: } goto fjov6; fjov6: Rybka: goto MUIRA; MUIRA: foreach ($development_tables as $table) { goto MKNaM; MKNaM: $development_table = $development_table_structures[$table]; goto bUYoi; fKDdS: SqcjU: goto Fs9J3; bUYoi: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto kXoR4; BYn9i: $tables_need_updating[] = $table; goto fKDdS; kXoR4: if (!($this->count_differences($development_table, $live_table) > 0)) { goto SqcjU; } goto BYn9i; Fs9J3: HKx1m: goto Dt3VD; Dt3VD: } goto ULe2Y; mfo1S: foreach ($development_tables as $table) { goto pBMTO; aXB3K: $table_structure = $query->row_array(); goto dnd96; dnd96: $development_table_structures[$table] = $table_structure["\103\162\x65\x61\164\145\40\124\141\142\x6c\145"]; goto bjrG3; pBMTO: $query = $this->DB1->query("\123\110\117\127\40\x43\x52\105\101\124\105\40\124\x41\x42\x4c\x45\x20\140{$table}\x60\x20\55\x2d\x20\144\145\x76"); goto aXB3K; bjrG3: CDU1o: goto nDwcs; nDwcs: } goto lChVf; ULe2Y: ZVs9b: goto xEogf; kEIIk: $live_table_structures = $development_table_structures = array(); goto mfo1S; xEogf: return $tables_need_updating; goto UivCo; lChVf: lh2oY: goto G930F; UivCo: } function count_differences($old, $new) { goto tDhSK; VW2XY: MX6rK: goto yf4Am; S72YV: $old = trim(preg_replace("\x2f\x5c\x73\x2b\x2f", '', $old)); goto tEgYk; tTjJM: $old = explode("\x20", $old); goto pdsGp; tDhSK: $differences = 0; goto S72YV; tEgYk: $new = trim(preg_replace("\x2f\134\163\53\57", '', $new)); goto sAUEJ; Ygqxo: goto YgAjT; goto VW2XY; W7KjL: zCxk_: goto tTjJM; JhK95: $length = max(count($old), count($new)); goto QUtbb; QUtbb: $i = 0; goto Kyl7b; bOR9x: XPUQT: goto qnivX; Kyl7b: YgAjT: goto GMm8h; EWNeb: if (!($old[$i] != $new[$i])) { goto XPUQT; } goto LevQr; G76PV: $i++; goto Ygqxo; pdsGp: $new = explode("\40", $new); goto JhK95; GMm8h: if (!($i < $length)) { goto MX6rK; } goto EWNeb; sAUEJ: if (!($old == $new)) { goto zCxk_; } goto jmF1n; qnivX: gVb44: goto G76PV; jmF1n: return $differences; goto W7KjL; LevQr: $differences++; goto bOR9x; yf4Am: return $differences; goto tgpbS; tgpbS: } function update_existing_tables($tables) { goto Tcs5f; eaEnf: if (!(is_array($tables) && !empty($tables))) { goto Ekv28; } goto aXytH; B8p5C: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto mVXfU; Ohd_x: eCR6y: goto QP_iQ; aXytH: foreach ($tables as $table) { goto WM6BH; YkOVL: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto QlOof; WM6BH: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto YkOVL; QlOof: G4DNR: goto GKT65; GKT65: } goto Ohd_x; QP_iQ: Ekv28: goto B8p5C; Tcs5f: $sql_commands_to_run = array(); goto XlU4L; mVXfU: return $sql_commands_to_run; goto tZmoz; XlU4L: $table_structure_development = array(); goto oLAYs; oLAYs: $table_structure_live = array(); goto eaEnf; tZmoz: } function table_field_data($database, $table) { goto FO2ez; AMMG6: return $fields; goto MYIis; Y3NOT: $fields[] = $row; goto ievo3; rbaLo: wF1jt: goto I6DUH; I6DUH: if (!($row = mysql_fetch_assoc($result))) { goto clYkr; } goto Y3NOT; FO2ez: $conn = mysqli_connect($database["\150\157\x73\164\156\141\155\x65"], $database["\x75\163\x65\162\x6e\141\x6d\145"], $database["\160\141\163\x73\x77\157\x72\144"]); goto m4418; itHyX: $result = mysql_query("\x53\x48\117\127\x20\103\117\x4c\x55\x4d\116\x53\x20\x46\x52\x4f\x4d\x20\x60{$table}\140"); goto rbaLo; RQBee: clYkr: goto AMMG6; m4418: mysql_select_db($database["\144\x61\x74\141\142\141\163\x65"]); goto itHyX; ievo3: goto wF1jt; goto RQBee; MYIis: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto kNlWp; DHGRK: return $sql_commands_to_run; goto jNij6; Pqh5W: foreach ($source_field_structures as $table => $fields) { goto rZ2ip; cmQz1: Qh25m: goto PAssg; rZ2ip: foreach ($fields as $field) { goto WEv_t; rkJAa: $modify_field = "\x41\x4c\x54\105\x52\40\x54\101\102\114\105\x20{$table}\40\x4d\x4f\104\111\x46\131\40\103\117\114\125\115\116\40\140" . $fields[$n]["\x46\x69\x65\x6c\144"] . "\x60\x20" . $fields[$n]["\x54\171\160\x65"] . "\x20\103\110\101\x52\x41\x43\124\105\122\40\123\105\x54\40" . $this->CHARACTER_SET; goto jz3V0; BxAHK: $previous_field = $fields[$n]["\x46\151\145\154\x64"]; goto WEo30; x50k7: $modify_field .= isset($previous_field) && $previous_field != '' ? "\40\x41\x46\x54\105\x52\40" . $previous_field : ''; goto bK05y; iUGK9: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto wlr9g; } goto aT59d; jz3V0: $modify_field .= isset($fields[$n]["\x44\x65\146\x61\x75\154\164"]) && $fields[$n]["\104\145\x66\141\x75\154\164"] != '' ? "\x20\104\105\x46\x41\125\114\x54\x20\47" . $fields[$n]["\x44\145\146\141\165\x6c\164"] . "\x27" : ''; goto CiJy1; XdXx5: gqxlQ: goto cugqD; Q9kkK: hs0mo: goto BxAHK; ycinG: hU7E1: goto KlpSs; WEv_t: if ($this->in_array_recursive($field["\x46\x69\x65\x6c\x64"], $destination_field_structures[$table])) { goto gqxlQ; } goto Uzwew; Uzwew: $add_field = "\101\114\124\105\x52\40\x54\x41\102\x4c\105\40{$table}\x20\101\104\x44\x20\x43\117\114\125\x4d\116\40\x60" . $field["\x46\151\145\x6c\144"] . "\140\x20" . $field["\x54\171\x70\x65"] . "\x20\x43\x48\101\x52\x41\x43\x54\105\122\40\123\x45\124\x20" . $this->CHARACTER_SET; goto WZNl0; O_t6h: goto oKDzE; goto XdXx5; UURbF: $add_field .= "\73"; goto R1KSe; Y36b4: TyzdP: goto rKaa6; uftgI: Yczci: goto w1Cwl; WEo30: PRNAx: goto iUGK9; rKaa6: $n++; goto O65W4; JojXt: $n = 0; goto yUhkK; CiJy1: $modify_field .= isset($fields[$n]["\x4e\x75\x6c\154"]) && $fields[$n]["\x4e\165\154\x6c"] == "\x59\105\x53" ? "\x20\x4e\125\114\114" : "\x20\x4e\x4f\x54\x20\x4e\x55\114\x4c"; goto WdlbK; WdlbK: $modify_field .= isset($fields[$n]["\x45\170\164\162\x61"]) && $fields[$n]["\x45\x78\164\162\x61"] != '' ? "\x20" . $fields[$n]["\105\x78\x74\x72\x61"] : ''; goto x50k7; KlpSs: oKDzE: goto uftgI; R1KSe: $sql_commands_to_run[] = $add_field; goto O_t6h; UsMY9: $add_field .= isset($field["\105\x78\x74\x72\x61"]) && $field["\105\170\x74\x72\x61"] != '' ? "\x20" . $field["\x45\170\164\x72\x61"] : ''; goto UURbF; WZNl0: $add_field .= isset($field["\116\165\154\154"]) && $field["\116\165\154\x6c"] == "\131\x45\x53" ? "\40\x4e\x75\x6c\x6c" : ''; goto BwS0P; cugqD: $modify_field = ''; goto JojXt; f9spi: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto SD8zn; yUhkK: Pn50m: goto pMBuj; aT59d: $sql_commands_to_run[] = $modify_field; goto o34RG; pMBuj: if (!($n < count($fields))) { goto hU7E1; } goto J8_pO; o34RG: wlr9g: goto Y36b4; O65W4: goto Pn50m; goto ycinG; BwS0P: $add_field .= "\40\x44\105\x46\101\125\114\x54\x20" . $field["\x44\x65\146\141\165\x6c\x74"]; goto UsMY9; bK05y: $modify_field .= "\x3b"; goto Q9kkK; SD8zn: if (!(is_array($differences) && !empty($differences))) { goto hs0mo; } goto rkJAa; J8_pO: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\106\151\x65\154\x64"] == $destination_field_structures[$table][$n]["\x46\x69\x65\x6c\x64"])) { goto PRNAx; } goto f9spi; w1Cwl: } goto gyK0T; gyK0T: PZUeg: goto cmQz1; PAssg: } goto a1YZd; a1YZd: hWx7i: goto DHGRK; kNlWp: $sql_commands_to_run = array(); goto Pqh5W; jNij6: } function in_array_recursive($needle, $haystack, $strict = false) { goto e89Ok; vH2Pb: return false; goto HD3qe; e89Ok: foreach ($haystack as $array => $item) { goto InkV4; HD_FC: return true; goto tQm3p; yd9XD: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto RWmd0; } goto HD_FC; UaOrJ: FZ2_F: goto ePBPS; InkV4: $item = $item["\x46\151\145\x6c\x64"]; goto yd9XD; tQm3p: RWmd0: goto UaOrJ; ePBPS: } goto ex2sX; ex2sX: ZhpvO: goto vH2Pb; HD3qe: } }
