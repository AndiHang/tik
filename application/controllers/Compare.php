<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto Wddby; Wddby: if (defined("\102\101\123\105\x50\101\x54\110")) { goto oxCvz; } goto A8FGi; k_6OI: oxCvz: goto TSpAj; A8FGi: exit("\x4e\157\x20\x64\151\162\145\x63\164\x20\x73\x63\162\x69\160\x74\x20\x61\x63\x63\x65\163\163\x20\x61\154\x6c\x6f\x77\145\144"); goto k_6OI; TSpAj: class Compare extends CI_Controller { function __construct() { goto xTrsH; OM0ik: $this->DB2 = $this->load->database("\154\x69\166\145", TRUE); goto ZRrID; mHNHG: $this->CHARACTER_SET = "\x75\164\x66\x38\x20\x43\117\114\114\x41\124\105\40\165\164\146\x38\137\x67\x65\156\x65\x72\141\x6c\137\143\151"; goto d155c; xTrsH: parent::__construct(); goto mHNHG; d155c: $this->DB1 = $this->load->database("\x6d\141\151\x6e\x5f\x67\x61\x72\165\144\141", TRUE); goto OM0ik; ZRrID: } function index() { goto NuDqV; NuDqV: $sql_commands_to_run = array(); goto ZsxIq; EOzi_: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\12"; jGqHp: } goto g5zi7; EacyP: E9sYp: goto xU40S; t8igB: $tables_to_drop = array_diff($live_tables, $development_tables); goto EIxXX; yRjPD: echo "\x3c\160\162\x65\x20\x73\164\171\x6c\145\75\47\x70\141\x64\x64\x69\156\147\x3a\40\x32\x30\x70\170\x3b\x20\142\141\143\x6b\147\x72\157\x75\156\x64\x2d\143\x6f\x6c\157\162\x3a\40\x23\x46\106\x46\x41\106\x30\x3b\x27\76\xa"; goto EOzi_; xU40S: echo "\74\x68\62\x3e\x54\x68\145\x20\x64\x61\164\x61\142\141\x73\145\x20\x69\x73\40\157\x75\x74\x20\x6f\146\40\123\171\156\143\x21\74\x2f\150\x32\76\12"; goto QIiw3; gUlOM: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\144\x72\x6f\160")) : array(); goto aMPID; udkLI: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto xgbwJ; ZsxIq: $development_tables = $this->DB1->list_tables(); goto FhNnI; APNE0: echo "\74\x70\162\x65\x3e\12"; goto O41Yt; xgbwJ: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto E9sYp; } goto kJ18Z; O41Yt: eu1ix: goto OdHpk; D0bt1: goto eu1ix; goto EacyP; eBXmv: $tables_to_create = array_diff($development_tables, $live_tables); goto t8igB; tWT2_: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto udkLI; kJ18Z: echo "\x3c\150\62\76\124\x68\145\40\x64\x61\164\141\x62\141\x73\145\x20\x61\x70\x70\145\141\162\163\40\x74\x6f\40\x62\x65\x20\x75\160\x20\164\157\40\x64\141\x74\145\x3c\x2f\150\x32\x3e\12"; goto D0bt1; FhNnI: $live_tables = $this->DB2->list_tables(); goto eBXmv; aMPID: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto tWT2_; EIxXX: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\x63\x72\145\x61\x74\x65")) : array(); goto gUlOM; g5zi7: CuhFg: goto APNE0; QIiw3: echo "\74\160\76\124\150\x65\40\146\x6f\154\154\x6f\167\151\x6e\147\40\x53\x51\x4c\x20\x63\x6f\155\x6d\x61\x6e\144\x73\40\156\x65\145\x64\40\164\x6f\40\x62\x65\40\145\170\x65\143\x75\x74\x65\144\40\164\157\x20\x62\x72\x69\156\x67\x20\x74\x68\x65\x20\x4c\151\166\145\40\144\x61\164\x61\x62\x61\163\145\x20\164\x61\142\x6c\x65\x73\40\x75\x70\40\164\157\x20\144\141\x74\x65\72\x20\74\x2f\x70\x3e\xa"; goto yRjPD; OdHpk: } function manage_tables($tables, $action) { goto iwLtF; kxgQN: xJgG7: goto kZf_4; dRksG: if (!($action == "\144\162\x6f\160")) { goto Um0HM; } goto m3sJk; cqIxj: Um0HM: goto T9J7j; m3sJk: foreach ($tables as $table) { $sql_commands_to_run[] = "\x44\122\x4f\120\x20\124\101\102\114\x45\40{$table}\73"; tW8FE: } goto mPWP0; TGM0w: foreach ($tables as $table) { goto ZwOml; Bg6hX: f1LN5: goto Flzz7; LAXCP: $sql_commands_to_run[] = $table_structure["\x43\x72\x65\x61\x74\x65\x20\x54\x61\142\x6c\145"] . "\x3b"; goto Bg6hX; ExcUl: $table_structure = $query->row_array(); goto LAXCP; ZwOml: $query = $this->DB1->query("\123\x48\x4f\x57\40\x43\x52\x45\x41\x54\105\x20\x54\x41\x42\114\105\x20\x60{$table}\x60\x20\55\55\40\x63\162\x65\141\164\x65\40\x74\141\142\x6c\145\x73"); goto ExcUl; Flzz7: } goto kxgQN; kZf_4: uRQ5t: goto dRksG; mPWP0: XILmz: goto cqIxj; lOAwz: if (!($action == "\x63\x72\x65\x61\x74\x65")) { goto uRQ5t; } goto TGM0w; T9J7j: return $sql_commands_to_run; goto O_4Lm; iwLtF: $sql_commands_to_run = array(); goto lOAwz; O_4Lm: } function compare_table_structures($development_tables, $live_tables) { goto FKTsB; sGi5V: foreach ($development_tables as $table) { goto HAHtd; HAHtd: $development_table = $development_table_structures[$table]; goto Bl4Hx; t97CD: gdkRE: goto C9OsX; an3li: $tables_need_updating[] = $table; goto t97CD; aogRn: if (!($this->count_differences($development_table, $live_table) > 0)) { goto gdkRE; } goto an3li; Bl4Hx: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto aogRn; C9OsX: PnhK2: goto uKp22; uKp22: } goto TxnO7; M1GPu: return $tables_need_updating; goto fWujJ; NRgN6: foreach ($development_tables as $table) { goto AGeB_; nacUY: QThi5: goto amhxG; ACj7j: $development_table_structures[$table] = $table_structure["\x43\x72\145\x61\164\145\40\x54\141\x62\x6c\145"]; goto nacUY; gu_79: $table_structure = $query->row_array(); goto ACj7j; AGeB_: $query = $this->DB1->query("\x53\x48\117\127\x20\103\x52\105\101\x54\105\40\x54\101\x42\114\x45\x20\140{$table}\x60\x20\x2d\x2d\40\x64\145\x76"); goto gu_79; amhxG: } goto eHivn; FKTsB: $tables_need_updating = array(); goto fQTtz; eHivn: O2X5E: goto pXkyx; fQTtz: $live_table_structures = $development_table_structures = array(); goto NRgN6; TxnO7: Uy04T: goto M1GPu; pXkyx: foreach ($live_tables as $table) { goto SqsXI; UdyT3: rEH3i: goto IvCeA; SqsXI: $query = $this->DB2->query("\123\110\x4f\x57\x20\103\x52\105\x41\x54\105\x20\x54\x41\102\114\x45\40\x60{$table}\140\40\55\55\40\154\151\x76\x65"); goto ORCxM; sIucw: $live_table_structures[$table] = $table_structure["\103\x72\145\141\164\x65\40\124\141\x62\154\x65"]; goto UdyT3; ORCxM: $table_structure = $query->row_array(); goto sIucw; IvCeA: } goto IfII4; IfII4: a227F: goto sGi5V; fWujJ: } function count_differences($old, $new) { goto ImxCw; CQgDI: if (!($old[$i] != $new[$i])) { goto SGLs9; } goto OIyjD; oQpX9: $old = explode("\40", $old); goto x0bw8; QhmDX: $old = trim(preg_replace("\x2f\134\163\x2b\x2f", '', $old)); goto SWDRn; SWDRn: $new = trim(preg_replace("\x2f\134\163\53\57", '', $new)); goto UC40S; ndDdj: $i++; goto U60g0; EIBxB: if (!($i < $length)) { goto dAVrI; } goto CQgDI; mEyFc: AiYz6: goto oQpX9; ohOvk: return $differences; goto mEyFc; UrfSJ: dAVrI: goto gsZm2; UC40S: if (!($old == $new)) { goto AiYz6; } goto ohOvk; w_7G8: $length = max(count($old), count($new)); goto nQXpn; LL2np: XkE2Q: goto ndDdj; x0bw8: $new = explode("\40", $new); goto w_7G8; ceMEx: a4be_: goto EIBxB; U60g0: goto a4be_; goto UrfSJ; nQXpn: $i = 0; goto ceMEx; OIyjD: $differences++; goto xeLK1; gsZm2: return $differences; goto ffOBT; ImxCw: $differences = 0; goto QhmDX; xeLK1: SGLs9: goto LL2np; ffOBT: } function update_existing_tables($tables) { goto Vh_sW; Fg7EE: return $sql_commands_to_run; goto loju1; Vh_sW: $sql_commands_to_run = array(); goto tc2Dl; wt9Qs: foreach ($tables as $table) { goto Brkzs; Brkzs: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto fYM0W; fYM0W: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto gJNS5; gJNS5: rtFW6: goto TSwlZ; TSwlZ: } goto u77av; tc2Dl: $table_structure_development = array(); goto CcBUe; CcBUe: $table_structure_live = array(); goto iCRnf; iCRnf: if (!(is_array($tables) && !empty($tables))) { goto Dhoau; } goto wt9Qs; mpNDb: Dhoau: goto Tljzf; Tljzf: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto Fg7EE; u77av: XkuLu: goto mpNDb; loju1: } function table_field_data($database, $table) { goto K3AgK; HSC3a: if (!($row = mysql_fetch_assoc($result))) { goto ZJmDL; } goto Shu8O; QyEgM: mysql_select_db($database["\144\x61\x74\141\x62\141\163\x65"]); goto vU3_1; ubVO2: return $fields; goto H97Ki; oB7kb: ZJmDL: goto ubVO2; kqSwX: idYWg: goto HSC3a; qdXpv: goto idYWg; goto oB7kb; vU3_1: $result = mysql_query("\x53\110\117\127\40\103\x4f\x4c\125\115\116\123\40\x46\x52\x4f\115\40\140{$table}\x60"); goto kqSwX; K3AgK: $conn = mysqli_connect($database["\x68\157\163\x74\156\x61\x6d\x65"], $database["\165\x73\x65\162\x6e\x61\x6d\x65"], $database["\160\141\163\x73\167\157\x72\144"]); goto QyEgM; Shu8O: $fields[] = $row; goto qdXpv; H97Ki: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto ArFoR; vcN4T: yyBqX: goto NR5Li; ArFoR: $sql_commands_to_run = array(); goto wt5q6; wt5q6: foreach ($source_field_structures as $table => $fields) { goto LSckW; FA4x7: Nn_FD: goto b2EZS; mdtNd: nPdUI: goto FA4x7; LSckW: foreach ($fields as $field) { goto Na5JP; ECdxp: goto J8iHz; goto tdXG6; APeAI: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto INrwk; } goto Ohe0D; CiwnR: $previous_field = $fields[$n]["\106\151\x65\x6c\144"]; goto QK1lt; jRi8X: $modify_field = ''; goto GSjPe; Si7Yy: $add_field .= isset($field["\x45\170\x74\162\x61"]) && $field["\105\170\x74\162\141"] != '' ? "\x20" . $field["\105\170\x74\162\x61"] : ''; goto etmE3; ZKTCj: J8iHz: goto hR8sc; GSjPe: $n = 0; goto ZKTCj; RC3_d: XvkIY: goto jRi8X; wbTr8: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\x46\151\145\x6c\144"] == $destination_field_structures[$table][$n]["\106\151\145\154\x64"])) { goto KrHcU; } goto CcQCw; hR8sc: if (!($n < count($fields))) { goto SmZyl; } goto wbTr8; Na5JP: if ($this->in_array_recursive($field["\x46\151\145\x6c\144"], $destination_field_structures[$table])) { goto XvkIY; } goto KxIlP; Ohe0D: $sql_commands_to_run[] = $modify_field; goto klcjT; QK1lt: KrHcU: goto APeAI; s7b9d: nzKgL: goto EOiz4; etmE3: $add_field .= "\x3b"; goto NxxRp; lTcED: H_Xi4: goto CiwnR; g9CO9: $modify_field .= isset($fields[$n]["\105\170\x74\162\141"]) && $fields[$n]["\x45\x78\x74\x72\141"] != '' ? "\x20" . $fields[$n]["\105\x78\x74\162\x61"] : ''; goto xnqWC; AeI7a: $add_field .= "\x20\x44\x45\x46\x41\125\x4c\124\40" . $field["\104\145\146\x61\165\x6c\x74"]; goto Si7Yy; eiGHL: if (!(is_array($differences) && !empty($differences))) { goto H_Xi4; } goto qcnnT; NxxRp: $sql_commands_to_run[] = $add_field; goto NkYP3; aFpzs: $modify_field .= isset($fields[$n]["\104\145\146\141\165\x6c\x74"]) && $fields[$n]["\104\145\146\x61\x75\154\164"] != '' ? "\40\104\x45\106\x41\x55\114\124\40\47" . $fields[$n]["\x44\x65\146\x61\x75\154\x74"] . "\x27" : ''; goto oxKdN; qcnnT: $modify_field = "\101\x4c\x54\105\122\40\124\x41\102\x4c\105\40{$table}\40\x4d\x4f\104\x49\x46\131\40\103\117\114\x55\115\x4e\40\140" . $fields[$n]["\x46\151\x65\x6c\144"] . "\140\x20" . $fields[$n]["\124\171\x70\x65"] . "\40\x43\110\x41\x52\101\x43\124\105\x52\40\x53\105\124\40" . $this->CHARACTER_SET; goto aFpzs; hg3qU: $n++; goto ECdxp; NkYP3: goto snaaM; goto RC3_d; l2bPE: $modify_field .= "\x3b"; goto lTcED; nSEGu: L1MJ5: goto hg3qU; oxKdN: $modify_field .= isset($fields[$n]["\x4e\165\x6c\154"]) && $fields[$n]["\116\x75\154\154"] == "\131\x45\x53" ? "\x20\116\x55\x4c\x4c" : "\x20\x4e\117\124\40\x4e\x55\114\114"; goto g9CO9; xnqWC: $modify_field .= isset($previous_field) && $previous_field != '' ? "\40\101\106\124\105\x52\40" . $previous_field : ''; goto l2bPE; KxIlP: $add_field = "\101\114\124\x45\x52\x20\124\x41\x42\114\x45\40{$table}\x20\x41\x44\x44\40\103\x4f\x4c\x55\x4d\x4e\40\140" . $field["\106\151\145\x6c\x64"] . "\140\x20" . $field["\x54\171\160\145"] . "\x20\103\x48\x41\122\101\x43\x54\105\122\x20\x53\105\x54\40" . $this->CHARACTER_SET; goto NnLJL; tdXG6: SmZyl: goto bzVQD; CcQCw: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto eiGHL; NnLJL: $add_field .= isset($field["\x4e\165\x6c\154"]) && $field["\116\165\x6c\154"] == "\131\105\123" ? "\40\x4e\165\x6c\x6c" : ''; goto AeI7a; klcjT: INrwk: goto nSEGu; bzVQD: snaaM: goto s7b9d; EOiz4: } goto mdtNd; b2EZS: } goto vcN4T; NR5Li: return $sql_commands_to_run; goto fAJO5; fAJO5: } function in_array_recursive($needle, $haystack, $strict = false) { goto MdApQ; RWVbQ: Rqp6D: goto rOhrp; MdApQ: foreach ($haystack as $array => $item) { goto VgYeJ; EVDZ7: return true; goto EmD3h; Y2oL5: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto mEqFa; } goto EVDZ7; EmD3h: mEqFa: goto kub1e; kub1e: d_np2: goto NLyxH; VgYeJ: $item = $item["\x46\151\x65\154\x64"]; goto Y2oL5; NLyxH: } goto RWVbQ; rOhrp: return false; goto bpUa6; bpUa6: } }
