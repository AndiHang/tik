<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto o_Ggz; o_Ggz: if (defined("\102\x41\123\x45\120\x41\124\110")) { goto d6Y3_; } goto Rj0Xu; F02E0: d6Y3_: goto xACMf; Rj0Xu: exit("\x4e\x6f\40\x64\151\162\x65\x63\164\x20\x73\143\x72\x69\x70\164\x20\141\143\x63\145\163\x73\x20\141\x6c\x6c\x6f\x77\145\144"); goto F02E0; xACMf: class Compare extends CI_Controller { function __construct() { goto fnIby; EF8NW: $this->CHARACTER_SET = "\x75\164\146\x38\x20\x43\x4f\x4c\114\x41\x54\105\40\x75\x74\x66\70\137\147\145\156\145\x72\x61\154\x5f\x63\151"; goto zbud5; zbud5: $this->DB1 = $this->load->database("\155\x61\151\x6e\137\147\141\162\x75\144\141", TRUE); goto TgRwn; TgRwn: $this->DB2 = $this->load->database("\154\151\x76\x65", TRUE); goto xLSSZ; fnIby: parent::__construct(); goto EF8NW; xLSSZ: } function index() { goto Jk29e; YaNET: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto TxuBL; } goto c11j_; D21Gg: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto uN4GT; fcxz5: echo "\74\x70\x3e\x54\x68\x65\40\x66\x6f\x6c\154\157\167\151\156\x67\40\123\121\x4c\40\143\157\x6d\155\x61\156\x64\x73\40\156\x65\x65\144\x20\x74\157\40\x62\x65\40\145\170\x65\143\165\x74\x65\144\40\x74\157\40\142\x72\x69\x6e\x67\40\164\x68\x65\40\x4c\151\166\x65\x20\x64\x61\x74\141\142\141\163\x65\40\164\x61\142\x6c\x65\x73\40\x75\x70\40\x74\157\x20\144\x61\164\145\x3a\x20\x3c\x2f\160\76\xa"; goto SeWin; g_lR3: $live_tables = $this->DB2->list_tables(); goto XBbKO; XBbKO: $tables_to_create = array_diff($development_tables, $live_tables); goto cTv3c; FEKOQ: $development_tables = $this->DB1->list_tables(); goto g_lR3; SJi59: echo "\74\150\x32\76\x54\x68\145\40\x64\141\164\x61\142\141\x73\145\x20\151\163\40\x6f\x75\x74\x20\157\146\40\123\171\x6e\143\41\74\x2f\x68\x32\76\12"; goto fcxz5; QGhIv: goto HhgCJ; goto xVJzX; Jk29e: $sql_commands_to_run = array(); goto FEKOQ; c11j_: echo "\x3c\150\62\76\x54\150\x65\40\144\x61\x74\141\142\141\163\x65\x20\141\160\x70\145\x61\x72\163\40\164\x6f\40\142\145\x20\165\x70\x20\164\157\40\x64\x61\164\x65\74\x2f\x68\x32\76\12"; goto QGhIv; SeWin: echo "\74\160\x72\145\40\x73\x74\x79\154\145\75\47\160\141\x64\x64\151\x6e\x67\72\x20\x32\60\160\x78\73\40\142\141\x63\x6b\x67\x72\157\165\156\144\x2d\143\x6f\154\157\x72\72\40\43\106\106\x46\101\x46\x30\x3b\x27\x3e\xa"; goto pLZ7s; snl_c: HhgCJ: goto hzL8u; uN4GT: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto YaNET; cTv3c: $tables_to_drop = array_diff($live_tables, $development_tables); goto dvXA4; pLZ7s: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\xa"; Ne2dO: } goto ZpD5q; unj5a: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto D21Gg; vAvGQ: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\x64\162\x6f\x70")) : array(); goto unj5a; ZpD5q: xSSIW: goto zwmX8; dvXA4: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\x63\162\145\x61\x74\145")) : array(); goto vAvGQ; zwmX8: echo "\74\160\x72\x65\76\12"; goto snl_c; xVJzX: TxuBL: goto SJi59; hzL8u: } function manage_tables($tables, $action) { goto L_XmE; McyqE: return $sql_commands_to_run; goto H1b8f; YpfvO: JoxwH: goto TrspQ; TrspQ: if (!($action == "\x64\x72\157\x70")) { goto RThkC; } goto r_jsu; Qz0ia: if (!($action == "\143\162\145\x61\x74\x65")) { goto JoxwH; } goto tvZwd; L_XmE: $sql_commands_to_run = array(); goto Qz0ia; r_jsu: foreach ($tables as $table) { $sql_commands_to_run[] = "\104\122\x4f\120\40\x54\x41\x42\114\105\x20{$table}\73"; BJzZ_: } goto K0XaB; K0XaB: MSQUE: goto IkOP2; tvZwd: foreach ($tables as $table) { goto gaUQn; gaUQn: $query = $this->DB1->query("\x53\x48\x4f\x57\40\x43\122\105\101\124\105\40\x54\101\102\114\105\x20\x60{$table}\x60\40\x2d\x2d\40\x63\162\x65\141\x74\145\x20\164\x61\x62\x6c\x65\163"); goto oMDW3; JeHei: E_wJc: goto g41vp; oMDW3: $table_structure = $query->row_array(); goto bSRyy; bSRyy: $sql_commands_to_run[] = $table_structure["\x43\x72\145\x61\164\145\x20\x54\141\x62\154\x65"] . "\73"; goto JeHei; g41vp: } goto TRuQb; TRuQb: S8FZf: goto YpfvO; IkOP2: RThkC: goto McyqE; H1b8f: } function compare_table_structures($development_tables, $live_tables) { goto I3_HV; y2khN: j4jg3: goto CI93B; I3_HV: $tables_need_updating = array(); goto bAQbR; bAQbR: $live_table_structures = $development_table_structures = array(); goto HlgLD; CI93B: foreach ($live_tables as $table) { goto BQNAm; eTqRe: $live_table_structures[$table] = $table_structure["\103\x72\145\x61\x74\x65\40\124\141\x62\x6c\x65"]; goto nYFVq; BQNAm: $query = $this->DB2->query("\x53\110\x4f\x57\40\x43\x52\105\101\x54\105\x20\x54\101\102\114\x45\40\140{$table}\140\40\x2d\55\40\x6c\151\x76\x65"); goto BvAIP; nYFVq: mb1LX: goto bxCJJ; BvAIP: $table_structure = $query->row_array(); goto eTqRe; bxCJJ: } goto DbPaP; UGyA2: z6hES: goto I7jQl; HlgLD: foreach ($development_tables as $table) { goto NeX07; wFa5o: rLlQe: goto YaGfE; mrRdf: $development_table_structures[$table] = $table_structure["\103\x72\145\141\164\145\40\124\x61\142\154\x65"]; goto wFa5o; NeX07: $query = $this->DB1->query("\x53\110\x4f\x57\40\x43\122\x45\x41\x54\105\40\x54\101\102\x4c\x45\40\140{$table}\140\40\x2d\55\40\x64\x65\x76"); goto kQqxo; kQqxo: $table_structure = $query->row_array(); goto mrRdf; YaGfE: } goto y2khN; I7jQl: return $tables_need_updating; goto jaaWo; OUU1c: foreach ($development_tables as $table) { goto LGO0M; LGO0M: $development_table = $development_table_structures[$table]; goto dfCe6; Z7VTc: ynu15: goto rZXoN; HGyTR: $tables_need_updating[] = $table; goto Z7VTc; dfCe6: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto rhJcJ; rZXoN: yWZqM: goto g2z3C; rhJcJ: if (!($this->count_differences($development_table, $live_table) > 0)) { goto ynu15; } goto HGyTR; g2z3C: } goto UGyA2; DbPaP: UK_vY: goto OUU1c; jaaWo: } function count_differences($old, $new) { goto RAdX1; RAdX1: $differences = 0; goto AMWqJ; dsNmA: WBf7J: goto Tc26Y; L4XcE: vurjf: goto YiUUL; n8h38: XJj_t: goto s2tZ4; cq0O7: if (!($old[$i] != $new[$i])) { goto tXhhA; } goto t94EM; Tc26Y: if (!($i < $length)) { goto vurjf; } goto cq0O7; t94EM: $differences++; goto s1GrZ; PeZ2p: $new = trim(preg_replace("\x2f\134\163\x2b\57", '', $new)); goto uvs6L; Z8kcm: p_fqz: goto Q6pj5; OKJCn: return $differences; goto n8h38; uvs6L: if (!($old == $new)) { goto XJj_t; } goto OKJCn; s1GrZ: tXhhA: goto Z8kcm; Jfs7y: $length = max(count($old), count($new)); goto ttwvp; dFd1v: $new = explode("\x20", $new); goto Jfs7y; s2tZ4: $old = explode("\40", $old); goto dFd1v; ttwvp: $i = 0; goto dsNmA; wYocI: goto WBf7J; goto L4XcE; YiUUL: return $differences; goto qvZko; Q6pj5: $i++; goto wYocI; AMWqJ: $old = trim(preg_replace("\x2f\x5c\163\53\x2f", '', $old)); goto PeZ2p; qvZko: } function update_existing_tables($tables) { goto y99UT; f5iog: $table_structure_live = array(); goto m7LeK; RLM84: $table_structure_development = array(); goto f5iog; zTGhx: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto zB0vx; m7LeK: if (!(is_array($tables) && !empty($tables))) { goto QfbU1; } goto zY1GS; y99UT: $sql_commands_to_run = array(); goto RLM84; h3VEp: QfbU1: goto zTGhx; zB0vx: return $sql_commands_to_run; goto SPmsJ; jNrFj: sscJi: goto h3VEp; zY1GS: foreach ($tables as $table) { goto AhG1w; AhG1w: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto dtkaa; dtkaa: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto af1FS; af1FS: iwNGM: goto LeBd5; LeBd5: } goto jNrFj; SPmsJ: } function table_field_data($database, $table) { goto S6_AM; xA609: mysql_select_db($database["\144\141\x74\141\x62\141\x73\145"]); goto eZSxk; NQasu: $fields[] = $row; goto K9DK9; wZs4i: h2b8O: goto e1RHU; K9DK9: goto h2b8O; goto EROVM; S6_AM: $conn = mysqli_connect($database["\150\157\x73\164\156\141\155\145"], $database["\x75\x73\x65\162\156\x61\155\145"], $database["\x70\x61\x73\x73\x77\x6f\x72\x64"]); goto xA609; xbBiD: return $fields; goto nK9d0; eZSxk: $result = mysql_query("\x53\110\x4f\x57\40\103\x4f\114\x55\115\x4e\123\40\106\x52\117\115\x20\140{$table}\x60"); goto wZs4i; e1RHU: if (!($row = mysql_fetch_assoc($result))) { goto Tik7g; } goto NQasu; EROVM: Tik7g: goto xbBiD; nK9d0: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto m9vmR; eKOFd: foreach ($source_field_structures as $table => $fields) { goto E6V5L; d4KLY: POsqm: goto R72nk; R72nk: KoBX9: goto wk03g; E6V5L: foreach ($fields as $field) { goto GC0aR; qBcCc: $n++; goto s7erU; OSE24: i2ds9: goto CMBmU; zCnp_: $add_field .= isset($field["\116\165\154\x6c"]) && $field["\116\165\x6c\154"] == "\x59\x45\123" ? "\40\116\165\154\154" : ''; goto s9C4P; Ym10Z: $modify_field .= isset($fields[$n]["\x4e\165\x6c\x6c"]) && $fields[$n]["\x4e\x75\x6c\154"] == "\131\x45\123" ? "\x20\116\x55\x4c\x4c" : "\40\116\117\124\x20\x4e\x55\114\114"; goto uDXte; wIwTs: $n = 0; goto HfQAa; zME30: $modify_field = ''; goto wIwTs; buxA6: $add_field .= "\x3b"; goto naI2c; s9C4P: $add_field .= "\40\x44\x45\x46\101\125\x4c\124\x20" . $field["\104\x65\146\x61\165\x6c\164"]; goto KwNnF; BgI3b: YMBpw: goto e0NKc; ltUc4: $sql_commands_to_run[] = $modify_field; goto OSE24; KwNnF: $add_field .= isset($field["\x45\x78\x74\x72\141"]) && $field["\x45\x78\x74\x72\x61"] != '' ? "\x20" . $field["\x45\x78\164\162\x61"] : ''; goto buxA6; kn37r: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto WWQgJ; naI2c: $sql_commands_to_run[] = $add_field; goto IvNaQ; s7erU: goto hO885; goto dCiDS; rQkJ0: toigI: goto zME30; KS4De: Q9ub7: goto OUjty; GGtcI: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\106\151\145\x6c\x64"] == $destination_field_structures[$table][$n]["\106\x69\145\x6c\144"])) { goto Q9ub7; } goto kn37r; HfQAa: hO885: goto dr7Op; vZhKI: $modify_field = "\101\114\x54\x45\x52\40\124\101\102\114\x45\x20{$table}\40\115\x4f\x44\111\x46\131\x20\103\x4f\114\x55\115\x4e\40\x60" . $fields[$n]["\106\151\x65\154\144"] . "\140\x20" . $fields[$n]["\124\x79\x70\145"] . "\x20\103\x48\101\x52\101\103\124\x45\122\40\x53\x45\x54\x20" . $this->CHARACTER_SET; goto VqmZH; OUjty: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto i2ds9; } goto ltUc4; e0NKc: $previous_field = $fields[$n]["\106\151\145\x6c\144"]; goto KS4De; uDXte: $modify_field .= isset($fields[$n]["\x45\170\164\x72\x61"]) && $fields[$n]["\105\170\x74\162\x61"] != '' ? "\x20" . $fields[$n]["\x45\x78\x74\162\141"] : ''; goto BHq2v; VqmZH: $modify_field .= isset($fields[$n]["\104\145\146\x61\x75\154\x74"]) && $fields[$n]["\x44\145\146\x61\165\154\164"] != '' ? "\x20\104\105\x46\x41\125\114\124\40\x27" . $fields[$n]["\x44\x65\x66\x61\165\154\x74"] . "\x27" : ''; goto Ym10Z; CMBmU: hQfy1: goto qBcCc; IvNaQ: goto TujfU; goto rQkJ0; QyLj5: TujfU: goto b1ODy; dr7Op: if (!($n < count($fields))) { goto e0SAD; } goto GGtcI; WWQgJ: if (!(is_array($differences) && !empty($differences))) { goto YMBpw; } goto vZhKI; KXgmh: $modify_field .= "\73"; goto BgI3b; dCiDS: e0SAD: goto QyLj5; UA7gh: $add_field = "\101\x4c\x54\105\x52\x20\124\101\x42\x4c\x45\40{$table}\x20\x41\104\104\x20\103\117\x4c\125\x4d\x4e\40\140" . $field["\106\151\x65\x6c\144"] . "\140\x20" . $field["\x54\171\160\145"] . "\x20\103\x48\101\x52\101\x43\124\105\x52\40\123\105\x54\40" . $this->CHARACTER_SET; goto zCnp_; b1ODy: NN_3y: goto Snt_n; GC0aR: if ($this->in_array_recursive($field["\x46\x69\145\x6c\x64"], $destination_field_structures[$table])) { goto toigI; } goto UA7gh; BHq2v: $modify_field .= isset($previous_field) && $previous_field != '' ? "\x20\101\106\124\105\x52\40" . $previous_field : ''; goto KXgmh; Snt_n: } goto d4KLY; wk03g: } goto TWYqP; TWYqP: OQwY7: goto un0KG; m9vmR: $sql_commands_to_run = array(); goto eKOFd; un0KG: return $sql_commands_to_run; goto mz39d; mz39d: } function in_array_recursive($needle, $haystack, $strict = false) { goto DJcmY; K5YXS: return false; goto r45tZ; PEX3K: SCPuQ: goto K5YXS; DJcmY: foreach ($haystack as $array => $item) { goto sBnFD; taSwf: return true; goto imx4M; imx4M: IfsMJ: goto eVych; sBnFD: $item = $item["\x46\x69\145\154\144"]; goto SQk6K; SQk6K: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto IfsMJ; } goto taSwf; eVych: orCMa: goto e0nc7; e0nc7: } goto PEX3K; r45tZ: } }
