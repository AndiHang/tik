<?php
/*   ________________________________________
    |                 GarudaCBT              |
    |    https://github.com/garudacbt/cbt    |
    |________________________________________|
*/
 goto wgVJZ; wgVJZ: if (defined("\102\101\123\x45\x50\101\124\x48")) { goto JJXYT; } goto SmRH8; hbiYR: JJXYT: goto kyOhj; SmRH8: exit("\x4e\157\x20\144\151\x72\145\x63\164\40\163\x63\162\151\160\164\40\x61\x63\x63\145\x73\163\x20\141\154\x6c\157\167\145\144"); goto hbiYR; kyOhj: class Compare extends CI_Controller { function __construct() { goto qZEAw; g3rex: $this->DB1 = $this->load->database("\155\x61\151\156\137\147\141\162\165\x64\141", TRUE); goto TIPHl; qZEAw: parent::__construct(); goto NM3lU; TIPHl: $this->DB2 = $this->load->database("\x6c\151\x76\145", TRUE); goto WlV7d; NM3lU: $this->CHARACTER_SET = "\x75\x74\146\70\x20\x43\x4f\114\114\101\124\x45\x20\x75\164\146\70\x5f\147\145\x6e\145\x72\141\x6c\137\143\151"; goto g3rex; WlV7d: } function index() { goto mEtUc; cjfH7: $sql_commands_to_run = is_array($tables_to_drop) && !empty($tables_to_drop) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_drop, "\x64\x72\x6f\x70")) : array(); goto USYIn; njg7w: $development_tables = $this->DB1->list_tables(); goto bYVfM; USYIn: $tables_to_update = $this->compare_table_structures($development_tables, $live_tables); goto DHF_d; DOkGb: $tables_to_drop = array_diff($live_tables, $development_tables); goto CHVuG; zwTvr: echo "\x3c\160\76\124\x68\x65\40\146\x6f\154\x6c\x6f\167\151\x6e\147\x20\x53\x51\114\40\x63\157\155\155\x61\x6e\144\163\40\156\x65\145\144\x20\164\x6f\x20\142\145\x20\x65\170\145\143\165\164\145\144\40\164\157\40\142\x72\151\156\x67\x20\x74\x68\x65\x20\x4c\151\166\x65\40\144\x61\164\141\142\141\163\x65\40\164\x61\142\x6c\145\163\x20\165\x70\x20\x74\157\x20\x64\x61\164\x65\x3a\40\x3c\57\160\x3e\xa"; goto rqDpZ; QcEYK: tNwLR: goto rd02Z; bYVfM: $live_tables = $this->DB2->list_tables(); goto NE3ut; rqDpZ: echo "\74\x70\x72\x65\x20\x73\x74\x79\154\x65\75\x27\160\x61\x64\144\151\156\x67\72\x20\62\60\160\170\73\x20\142\141\x63\153\147\x72\x6f\165\x6e\144\55\x63\x6f\154\157\x72\x3a\40\43\x46\106\106\x41\106\60\x3b\47\76\12"; goto lzpo4; mEtUc: $sql_commands_to_run = array(); goto njg7w; DHF_d: $tables_to_update = array_diff($tables_to_update, $tables_to_create); goto EVsPT; oc4In: goto tNwLR; goto sWs7X; CHVuG: $sql_commands_to_run = is_array($tables_to_create) && !empty($tables_to_create) ? array_merge($sql_commands_to_run, $this->manage_tables($tables_to_create, "\143\x72\145\141\x74\145")) : array(); goto cjfH7; EVsPT: $sql_commands_to_run = is_array($tables_to_update) && !empty($tables_to_update) ? array_merge($sql_commands_to_run, $this->update_existing_tables($tables_to_update)) : ''; goto HyuKo; qAaIG: iFvlD: goto aYfGv; sWs7X: SqeoG: goto HQ5HZ; aYfGv: echo "\74\160\x72\145\76\12"; goto QcEYK; NE3ut: $tables_to_create = array_diff($development_tables, $live_tables); goto DOkGb; HyuKo: if (is_array($sql_commands_to_run) && !empty($sql_commands_to_run)) { goto SqeoG; } goto d16Dg; HQ5HZ: echo "\x3c\150\x32\x3e\124\150\145\x20\144\x61\164\141\142\x61\163\x65\40\151\x73\40\157\165\164\40\x6f\146\40\123\x79\x6e\x63\41\74\57\150\x32\76\12"; goto zwTvr; lzpo4: foreach ($sql_commands_to_run as $sql_command) { echo "{$sql_command}\12"; q4aIW: } goto qAaIG; d16Dg: echo "\74\x68\62\x3e\124\150\145\x20\144\x61\x74\x61\142\x61\163\x65\40\141\x70\160\145\141\162\x73\x20\x74\157\40\x62\x65\40\165\160\40\x74\x6f\x20\144\141\x74\x65\74\x2f\x68\62\76\12"; goto oc4In; rd02Z: } function manage_tables($tables, $action) { goto csjHW; q5BZE: return $sql_commands_to_run; goto BnIL6; Y2Kq6: F1jJ6: goto eQHOM; csjHW: $sql_commands_to_run = array(); goto Hbl6t; Hbl6t: if (!($action == "\x63\x72\x65\x61\x74\x65")) { goto j1Pvj; } goto mQd72; Y6CBj: if (!($action == "\x64\162\x6f\x70")) { goto hb0_k; } goto GjmpC; eu8r0: hb0_k: goto q5BZE; A1_Vb: M4atv: goto eu8r0; eQHOM: j1Pvj: goto Y6CBj; mQd72: foreach ($tables as $table) { goto hp5xT; Yzpcf: fp9fq: goto MSzu7; kCIMJ: $table_structure = $query->row_array(); goto CHIJL; CHIJL: $sql_commands_to_run[] = $table_structure["\x43\162\x65\x61\164\x65\x20\x54\141\142\x6c\145"] . "\x3b"; goto Yzpcf; hp5xT: $query = $this->DB1->query("\x53\x48\117\127\x20\x43\x52\x45\x41\124\105\x20\124\x41\102\114\105\40\140{$table}\x60\x20\55\x2d\40\x63\x72\145\x61\x74\145\x20\164\141\x62\154\145\x73"); goto kCIMJ; MSzu7: } goto Y2Kq6; GjmpC: foreach ($tables as $table) { $sql_commands_to_run[] = "\104\x52\117\120\x20\124\x41\x42\x4c\x45\40{$table}\73"; s1e3r: } goto A1_Vb; BnIL6: } function compare_table_structures($development_tables, $live_tables) { goto xY8oT; kwz5V: return $tables_need_updating; goto mOuLt; XmGrQ: foreach ($development_tables as $table) { goto jJxgM; QaLky: AE3nE: goto myos_; jJxgM: $query = $this->DB1->query("\123\110\117\x57\40\x43\x52\x45\101\124\105\40\124\x41\x42\114\x45\40\140{$table}\x60\x20\x2d\55\40\144\x65\166"); goto krz9q; Wz1TG: $development_table_structures[$table] = $table_structure["\x43\162\145\x61\164\145\40\124\141\142\154\x65"]; goto QaLky; krz9q: $table_structure = $query->row_array(); goto Wz1TG; myos_: } goto O3iwH; Ts0qh: foreach ($development_tables as $table) { goto qYiwb; jLQ21: sttu7: goto qP0xi; JrBDy: if (!($this->count_differences($development_table, $live_table) > 0)) { goto sttu7; } goto FXgox; qYiwb: $development_table = $development_table_structures[$table]; goto klWWb; qP0xi: hyaAA: goto RVJtM; FXgox: $tables_need_updating[] = $table; goto jLQ21; klWWb: $live_table = isset($live_table_structures[$table]) ? $live_table_structures[$table] : ''; goto JrBDy; RVJtM: } goto S1VJ1; jCsT0: foreach ($live_tables as $table) { goto Pi1zI; Pi1zI: $query = $this->DB2->query("\123\110\x4f\x57\x20\103\x52\x45\101\124\105\x20\124\x41\102\114\105\x20\140{$table}\140\40\55\55\x20\154\x69\166\145"); goto b72ka; qNBzn: $live_table_structures[$table] = $table_structure["\x43\x72\x65\141\x74\145\40\x54\x61\x62\154\145"]; goto jQfdQ; jQfdQ: t6BgY: goto R79CI; b72ka: $table_structure = $query->row_array(); goto qNBzn; R79CI: } goto NG3uG; xY8oT: $tables_need_updating = array(); goto pMvvO; S1VJ1: Ybsuy: goto kwz5V; O3iwH: zpozN: goto jCsT0; NG3uG: vFKRB: goto Ts0qh; pMvvO: $live_table_structures = $development_table_structures = array(); goto XmGrQ; mOuLt: } function count_differences($old, $new) { goto XWQYb; ENqbj: goto dGOLQ; goto V4OOs; b9eVx: gLRoL: goto KMowb; VoDQk: return $differences; goto yyjKy; DBGBv: $differences++; goto eYa6s; YZ30d: if (!($old == $new)) { goto U3irK; } goto edYLM; JmlH8: U3irK: goto SuJAO; vRW61: dGOLQ: goto BFGh7; V4OOs: N91Kz: goto VoDQk; j8Gq1: $new = explode("\x20", $new); goto vBMLb; edYLM: return $differences; goto JmlH8; GrDj7: $new = trim(preg_replace("\57\134\163\x2b\57", '', $new)); goto YZ30d; vBMLb: $length = max(count($old), count($new)); goto Ntkwv; Ntkwv: $i = 0; goto vRW61; eYa6s: Zap8l: goto b9eVx; SuJAO: $old = explode("\40", $old); goto j8Gq1; BFGh7: if (!($i < $length)) { goto N91Kz; } goto NES4x; KMowb: $i++; goto ENqbj; IWyIP: $old = trim(preg_replace("\57\134\x73\53\57", '', $old)); goto GrDj7; NES4x: if (!($old[$i] != $new[$i])) { goto Zap8l; } goto DBGBv; XWQYb: $differences = 0; goto IWyIP; yyjKy: } function update_existing_tables($tables) { goto sEOlK; dPuZc: return $sql_commands_to_run; goto qrp9a; g02W4: KsXML: goto TDXTN; DAYDa: foreach ($tables as $table) { goto ButMB; O5g8n: sP3cz: goto jYlxw; ButMB: $table_structure_development[$table] = $this->table_field_data((array) $this->DB1, $table); goto sXl0O; sXl0O: $table_structure_live[$table] = $this->table_field_data((array) $this->DB2, $table); goto O5g8n; jYlxw: } goto FdioR; fiv2A: if (!(is_array($tables) && !empty($tables))) { goto KsXML; } goto DAYDa; EZP3T: $table_structure_development = array(); goto iyOmW; FdioR: xIn29: goto g02W4; sEOlK: $sql_commands_to_run = array(); goto EZP3T; iyOmW: $table_structure_live = array(); goto fiv2A; TDXTN: $sql_commands_to_run = array_merge($sql_commands_to_run, $this->determine_field_changes($table_structure_development, $table_structure_live)); goto dPuZc; qrp9a: } function table_field_data($database, $table) { goto KcJ_U; WMjQZ: if (!($row = mysql_fetch_assoc($result))) { goto d019d; } goto L4DaW; WxyCW: $result = mysql_query("\x53\110\117\127\x20\x43\117\x4c\x55\x4d\x4e\x53\x20\106\x52\x4f\115\x20\x60{$table}\x60"); goto OfjPO; L4DaW: $fields[] = $row; goto XH4fV; XH4fV: goto cG_Pq; goto yXy8_; f_nE5: return $fields; goto Hc4tx; lPpdJ: mysql_select_db($database["\x64\x61\164\141\142\141\x73\145"]); goto WxyCW; OfjPO: cG_Pq: goto WMjQZ; yXy8_: d019d: goto f_nE5; KcJ_U: $conn = mysqli_connect($database["\150\x6f\x73\x74\x6e\141\x6d\x65"], $database["\x75\x73\x65\162\x6e\141\x6d\145"], $database["\160\x61\x73\163\167\157\x72\x64"]); goto lPpdJ; Hc4tx: } function determine_field_changes($source_field_structures, $destination_field_structures) { goto pZOTT; AgqYf: return $sql_commands_to_run; goto i9f3N; kVL_Q: foreach ($source_field_structures as $table => $fields) { goto zt_jL; VKN_B: stZGr: goto SNKfC; zt_jL: foreach ($fields as $field) { goto a8FRb; aUo0q: $previous_field = $fields[$n]["\106\151\145\x6c\144"]; goto PxWzi; LxyFy: $modify_field .= "\73"; goto IqQWi; Dz9s3: goto wVa5_; goto h59ar; b6qs0: if (!(isset($fields[$n]) && isset($destination_field_structures[$table][$n]) && $fields[$n]["\x46\151\x65\154\x64"] == $destination_field_structures[$table][$n]["\106\x69\x65\x6c\x64"])) { goto CyJeh; } goto CxfRn; PxWzi: CyJeh: goto Ptx3o; CD7Aj: aLMT0: goto LE252; aQvn3: wVa5_: goto SK7pd; gV1uT: $n = 0; goto aQvn3; a8FRb: if ($this->in_array_recursive($field["\x46\151\145\x6c\144"], $destination_field_structures[$table])) { goto eFPQK; } goto c8cAU; SK7pd: if (!($n < count($fields))) { goto CjoTl; } goto b6qs0; xN0Kg: $modify_field .= isset($previous_field) && $previous_field != '' ? "\x20\101\106\124\105\122\x20" . $previous_field : ''; goto LxyFy; IqQWi: WURLl: goto aUo0q; Nhuws: $modify_field = "\x41\114\124\105\122\x20\124\x41\x42\114\105\40{$table}\x20\115\x4f\x44\111\x46\131\40\103\117\x4c\125\115\x4e\40\140" . $fields[$n]["\x46\x69\145\x6c\x64"] . "\x60\x20" . $fields[$n]["\124\x79\x70\145"] . "\40\103\110\x41\122\x41\103\124\105\x52\x20\x53\105\x54\x20" . $this->CHARACTER_SET; goto bIS4X; KsaLg: goto QJ0g2; goto E2jXy; yiSAf: $sql_commands_to_run[] = $add_field; goto KsaLg; ftS5x: QJ0g2: goto I9pRp; D_IFW: $modify_field = ''; goto gV1uT; c8cAU: $add_field = "\x41\x4c\x54\x45\x52\x20\x54\101\x42\x4c\105\40{$table}\40\101\104\104\x20\x43\x4f\x4c\125\x4d\116\x20\140" . $field["\106\x69\145\154\144"] . "\140\40" . $field["\x54\171\160\x65"] . "\x20\x43\110\x41\122\101\103\x54\x45\122\x20\x53\x45\x54\x20" . $this->CHARACTER_SET; goto xr02P; bIS4X: $modify_field .= isset($fields[$n]["\104\x65\146\x61\165\x6c\x74"]) && $fields[$n]["\x44\x65\146\x61\165\x6c\x74"] != '' ? "\40\x44\105\x46\x41\125\114\124\40\47" . $fields[$n]["\x44\145\146\141\165\x6c\164"] . "\47" : ''; goto FX6Fr; zlCsc: $modify_field .= isset($fields[$n]["\x45\x78\x74\x72\141"]) && $fields[$n]["\105\x78\x74\162\x61"] != '' ? "\40" . $fields[$n]["\x45\170\x74\162\x61"] : ''; goto xN0Kg; LE252: $n++; goto Dz9s3; mjbqE: $add_field .= "\73"; goto yiSAf; I9pRp: P7SAW: goto lzkfS; xr02P: $add_field .= isset($field["\x4e\x75\x6c\x6c"]) && $field["\x4e\165\154\154"] == "\131\x45\x53" ? "\x20\116\x75\x6c\154" : ''; goto wSnKq; wSnKq: $add_field .= "\x20\x44\105\106\101\125\x4c\x54\40" . $field["\x44\x65\x66\141\165\154\164"]; goto fvi5k; h59ar: CjoTl: goto ftS5x; LnL8F: $sql_commands_to_run[] = $modify_field; goto IAwA9; FX6Fr: $modify_field .= isset($fields[$n]["\x4e\x75\x6c\154"]) && $fields[$n]["\x4e\x75\154\154"] == "\x59\x45\123" ? "\x20\x4e\x55\x4c\114" : "\x20\116\117\124\x20\x4e\125\x4c\114"; goto zlCsc; CxfRn: $differences = array_diff($fields[$n], $destination_field_structures[$table][$n]); goto g2TAy; IAwA9: r4Ws6: goto CD7Aj; Ptx3o: if (!($modify_field != '' && !in_array($modify_field, $sql_commands_to_run))) { goto r4Ws6; } goto LnL8F; g2TAy: if (!(is_array($differences) && !empty($differences))) { goto WURLl; } goto Nhuws; E2jXy: eFPQK: goto D_IFW; fvi5k: $add_field .= isset($field["\x45\x78\164\x72\x61"]) && $field["\105\x78\x74\162\141"] != '' ? "\40" . $field["\105\x78\164\162\141"] : ''; goto mjbqE; lzkfS: } goto VKN_B; SNKfC: Cimm3: goto OXAbT; OXAbT: } goto Cttxb; pZOTT: $sql_commands_to_run = array(); goto kVL_Q; Cttxb: jmE4F: goto AgqYf; i9f3N: } function in_array_recursive($needle, $haystack, $strict = false) { goto JC4cR; JC4cR: foreach ($haystack as $array => $item) { goto FB8wg; qgVFV: sMRv8: goto dEIXH; dEIXH: hnDHi: goto LMKq_; K3Dlf: if (!(($strict ? $item === $needle : $item == $needle) || is_array($item) && in_array_recursive($needle, $item, $strict))) { goto sMRv8; } goto FAdla; FAdla: return true; goto qgVFV; FB8wg: $item = $item["\106\x69\145\154\x64"]; goto K3Dlf; LMKq_: } goto MRQCV; MRQCV: tcKGJ: goto KR16D; KR16D: return false; goto jO2t3; jO2t3: } }
